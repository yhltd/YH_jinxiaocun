<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯è¾“å…¥ -->
  <view class="input-section">
    <view class="form-group">
      <text class="form-label">éƒ¨é—¨</text>
      <input 
        class="form-input" 
        placeholder="è¯·è¾“å…¥éƒ¨é—¨åç§°" 
        value="{{department}}" 
        bindinput="onDepartmentInput"
      />
    </view>
    
    <view class="form-group">
      <text class="form-label">å§“å</text>
      <input 
        class="form-input" 
        placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" 
        value="{{userName}}" 
        bindinput="onUserNameInput"
      />
    </view>
    
    <button 
      class="btn-save-userinfo" 
      bindtap="saveUserInfo"
      hover-class="btn-hover"
    >
      ä¿å­˜ä¸ªäººä¿¡æ¯
    </button>
  </view>

  <!-- æ¸…ç©ºå½“å¤©ç­¾åˆ°æ•°æ® -->
<!-- <view class="debug-section">
  <view class="debug-buttons">
    <button 
      class="btn-debug" 
      size="mini" 
      bindtap="clearTodayData"
      hover-class="btn-hover"
    >
      æ¸…ç©ºä»Šæ—¥æ•°æ®
    </button> 
  </view>
</view> -->

  <!-- å½“å‰æ—¶é—´æ˜¾ç¤º -->
  <view class="time-display">
    <text class="current-date">{{currentDate}}</text>
    <text class="current-time">{{currentTime}}</text>
  </view>

  <!-- æ‰“å¡æ“ä½œåŒºåŸŸ -->
  <view class="punch-section">
    <view class="punch-buttons">
      <!-- ç­¾åˆ°æŒ‰é’® -->
      <button 
        class="btn-punch {{signInDisabled ? 'disabled' : ''}}"
        type="primary"
        bindtap="signIn"
        disabled="{{signInDisabled}}"
        hover-class="btn-hover"
      >
        <text class="punch-icon">ğŸ“</text>
        <text>ç­¾åˆ°</text>
        <text wx:if="{{signInTime}}" class="punch-time">{{signInTime}}</text>
      </button>
      
      <!-- ç­¾é€€æŒ‰é’® -->
      <button 
        class="btn-punch {{signOutDisabled ? 'disabled' : ''}}"
        type="warn"
        bindtap="signOut"
        disabled="{{signOutDisabled}}"
        hover-class="btn-hover"
      >
        <text class="punch-icon">âœ…</text>
        <text>ç­¾é€€</text>
        <text wx:if="{{signOutTime}}" class="punch-time">{{signOutTime}}</text>
      </button>
    </view>
    
  </view>

  <!-- æ‰“å¡è®°å½• -->
  <view class="records-section">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥æ‰“å¡è®°å½•</text>
      <!-- <text class="refresh-btn" bindtap="refreshRecords">åˆ·æ–°</text> -->
    </view>
    
    <view wx:if="{{todayRecords.length > 0}}" class="records-list">
      <block wx:for="{{todayRecords}}" wx:key="index">
        <view class="record-item">
          <text class="record-type {{item.type === 'signIn' ? 'sign-in' : 'sign-out'}}">
            {{item.type === 'signIn' ? 'ç­¾åˆ°' : 'ç­¾é€€'}}
          </text>
          <text class="record-time">{{item.time}}</text>
          <text class="record-status {{item.isValid ? 'valid' : 'invalid'}}">
            {{item.isValid ? 'æ­£å¸¸' : 'å¼‚å¸¸'}}
          </text>
          <text class="record-message">{{item.message}}</text>
        </view>
      </block>
    </view>
    
    <view wx:else class="empty-records">
      <text>æš‚æ— æ‰“å¡è®°å½•</text>
    </view>
  </view>

  <!-- å·¥ä½œå®‰æ’ä¿¡æ¯ -->
  <view wx:if="{{workSchedule}}" class="schedule-info">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥å·¥ä½œå®‰æ’</text>
    </view>
    
    <view class="schedule-detail">
      <view class="schedule-row">
        <text class="schedule-label">æ’ç­ï¼š</text>
        <text class="schedule-value">{{workSchedule.schedule_title}}</text>
      </view>
      
      <view class="schedule-row">
        <text class="schedule-label">å·¥ä½œæ—¶é—´ï¼š</text>
        <text class="schedule-value">{{workSchedule.gongzuoshijianks}} - {{workSchedule.gongzuoshijianjs}}</text>
      </view>
      
      <view class="schedule-row">
        <text class="schedule-label">åˆä¼‘æ—¶é—´ï¼š</text>
        <text class="schedule-value">{{workSchedule.wuxiushijianks}} - {{workSchedule.wuxiushijianjs}}</text>
      </view>
      
      <view class="schedule-row">
        <text class="schedule-label">åº”åˆ°æ—¥æœŸï¼š</text>
        <text class="schedule-value">{{workSchedule.work_days ? workSchedule.work_days.length : 0}}å¤©</text>
      </view>
    </view>
  </view>

  <!-- è¯·å‡ç”³è¯·æ¨¡å— -->
<view class="leave-section">
  <view class="section-header">
    <text class="section-title">è¯·å‡ç”³è¯·</text>
    <button 
      class="btn-leave-apply" 
      size="mini" 
      bindtap="showLeaveApplication"
      hover-class="btn-hover"
    >
      ç”³è¯·è¯·å‡
    </button>
  </view>
  
  <!-- æœ€è¿‘è¯·å‡ç»“æœæç¤º -->
  <view wx:if="{{latestLeaveResult}}" class="leave-result-toast">
    <text>{{latestLeaveResult.message}}</text>
  </view>
  
  <!-- æˆ‘çš„è¯·å‡è®°å½• -->
  <view wx:if="{{myLeaveRecords.length > 0}}" class="leave-records">
    <view class="leave-records-header">
      <text class="leave-record-header-cell" style="width: 25%;">è¯·å‡æ—¶é—´</text>
      <text class="leave-record-header-cell" style="width: 20%;">å¤©æ•°</text>
      <text class="leave-record-header-cell" style="width: 30%;">åŸå› </text>
      <text class="leave-record-header-cell" style="width: 20%;">çŠ¶æ€</text>
    </view>
    
    <view class="leave-records-list">
      <block wx:for="{{myLeaveRecords}}" wx:key="id">
        <view class="leave-record-item">
          <text class="leave-record-cell" style="width: 25%;">
            <text>{{item.qsqingjiashijian}}</text>
            <text>{{item.jzqingjiashijan}}</text>
          </text>
          <text class="leave-record-cell" style="width: 20%;">{{item.daysCount || 0}}å¤©</text>
          <text class="leave-record-cell" style="width: 30%;">{{item.qingjiayuanyin || '--'}}</text>
          <text class="leave-record-cell" style="width: 20%; color: {{item.statusColor}};">
            {{item.zhuangtai || 'å¾…å®¡æ‰¹'}}
          </text>
        </view>
      </block>
    </view>
  </view>
  
  <view wx:else class="empty-leave-records">
    <text>æš‚æ— è¯·å‡è®°å½•</text>
  </view>
</view>

<!-- è¯·å‡ç”³è¯·å¼¹çª— -->
<view wx:if="{{leaveApplication.visible}}" class="modal-overlay">
  <view class="modal-container">
    <view class="modal-header">
      <text class="modal-title">è¯·å‡ç”³è¯·</text>
      <text class="modal-close" bindtap="hideLeaveApplication">Ã—</text>
    </view>
    
    <view class="modal-content">
      <view class="form-group">
        <text class="form-label">è¯·å‡å¼€å§‹æ—¥æœŸ</text>
        <picker 
          mode="date" 
          value="{{leaveApplication.startDate}}" 
          bindchange="onLeaveStartDateChange"
        >
          <view class="picker-input">
            {{leaveApplication.startDate || 'è¯·é€‰æ‹©å¼€å§‹æ—¥æœŸ'}}
          </view>
        </picker>
      </view>
      
      <view class="form-group">
        <text class="form-label">è¯·å‡ç»“æŸæ—¥æœŸ</text>
        <picker 
          mode="date" 
          value="{{leaveApplication.endDate}}" 
          bindchange="onLeaveEndDateChange"
        >
          <view class="picker-input">
            {{leaveApplication.endDate || 'è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ'}}
          </view>
        </picker>
      </view>
      
      <view class="form-group">
        <text class="form-label">è¯·å‡åŸå› </text>
        <textarea 
          class="textarea-input" 
          placeholder="è¯·è¾“å…¥è¯·å‡åŸå› "
          value="{{leaveApplication.reason}}"
          bindinput="onLeaveReasonInput"
          maxlength="500"
          auto-height
        />
      </view>
      
      <view class="form-group">
        <text class="form-label">ç”³è¯·ä¿¡æ¯</text>
        <view class="info-display">
          <text>ç”³è¯·äººï¼š{{userName}}</text>
          <text>éƒ¨é—¨ï¼š{{department}}</text>
          <text>å…¬å¸ï¼š{{companyName}}</text>
        </view>
      </view>
    </view>
    
    <view class="modal-footer">
      <button 
        class="btn-modal btn-modal-cancel" 
        bindtap="hideLeaveApplication"
        hover-class="btn-hover"
      >
        å–æ¶ˆ
      </button>
      <button 
        class="btn-modal btn-modal-submit" 
        type="primary" 
        bindtap="submitLeaveApplication"
        loading="{{leaveApplication.submitting}}"
        disabled="{{leaveApplication.submitting}}"
        hover-class="btn-hover"
      >
        {{leaveApplication.submitting ? 'æäº¤ä¸­...' : 'æäº¤ç”³è¯·'}}
      </button>
    </view>
  </view>
</view>

  <!-- æ¶ˆæ¯æç¤º -->
  <view wx:if="{{message}}" class="message-toast {{message.type}}">
    <text>{{message.text}}</text>
  </view>
</view>